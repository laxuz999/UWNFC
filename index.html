<!-- index.html  rev28 -->
<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>NFC カスタムオーダー</title>

    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- カスタムスタイル（スクロールバー & フェードイン） -->
    <style>
      ::-webkit-scrollbar { width: 8px; height: 8px; }
      ::-webkit-scrollbar-track { background: #f1f1f1; }
      ::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
      ::-webkit-scrollbar-thumb:hover { background: #555; }

      .animate-fade-in { animation: fadeIn 0.3s ease-in-out; }
      @keyframes fadeIn {
        from { opacity: 0; } to { opacity: 1; }
      }
    </style>

    <!-- React 用 importmap -->
    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@^19.1.0",
          "react-dom/": "https://esm.sh/react-dom@^19.1.0/",
          "react/": "https://esm.sh/react@^19.1.0/",
          "qrcode.react": "https://esm.sh/qrcode.react@^4.2.0"
        }
      }
    </script>

    <!-- 共通 CSS／JS -->
    <link rel="stylesheet" href="/index.css" />
    <link rel="stylesheet" href="style.css?rev27" />
    <script src="app.js?rev27" defer></script>
  </head>

  <body class="bg-gray-50">
    <!-- React アプリのマウントポイント -->
    <div id="root"></div>

    <!-- ▼ スクリプト：Step2 の入力欄直下へリンク一覧を挿入 ---------------- -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // React が描画し終わるまで待ち、最長 3 秒ポーリング
        const maxWait = 3000, interval = 150;
        let waited = 0;
        const timer = setInterval(() => {
          // React 側 Step2 の URL 入力欄（placeholder で判定）
          const inputs = document.querySelectorAll('input[placeholder="https://example.com"]');
          if (inputs.length >= 1) {
            clearInterval(timer);
            const targetInput = inputs[inputs.length - 1]; // 最後＝React 側
            // 既にリンクを挿入済みならスキップ
            if (targetInput.parentElement.querySelector('.nfc-link-list')) return;

            // UL 要素を生成
            const ul = document.createElement('ul');
            ul.className = 'nfc-link-list list-disc pl-6 space-y-2 text-sm mt-3';
            ul.innerHTML = `
            <li>LINE のやり方：
              <a href="./lineurl.html" target="_blank" rel="noopener" class="text-blue-600 underline">こちら</a>
            </li>
            <li>Instagram のやり方：
              <a href="./instagramurl.html" target="_blank" rel="noopener" class="text-blue-600 underline">こちら</a>
            </li>
          `;
            // 入力欄の直後に挿入
            targetInput.parentElement.appendChild(ul);
          }
          if ((waited += interval) > maxWait) clearInterval(timer);
        }, interval);
      });
    </script>
    <!-- ▲ スクリプトここまで ---------------------------------------------- -->

    <!-- React エントリ -->
    <script type="module" src="/index.tsx"></script>

    <!-- ▼ debug-upload.js: アップロード診断用スニペット（後で削除可） -->
    <script>
      /* ① ファイル選択直後の状態を確認 */
      document.querySelector('input[type="file"]')
        ?.addEventListener('change', e => {
          const file = e.target.files[0];
          if (!file) return;

          console.group('[UPLOAD DEBUG] ファイル選択');
          console.table({
            name: file.name,
            size: file.size + ' byte',
            type: file.type
          });

          const r = new FileReader();
          r.onload = ev => console.log('base64 head:', ev.target.result.slice(0, 60) + ' …');
          r.readAsDataURL(file);
          console.groupEnd();
        });

      /* ② fetch をフックして通信内容を監視 */
      const _fetch = window.fetch;
      window.fetch = async (...args) => {
        const [resource, init] = args;
        if (init && init.method === 'POST') {
          console.group('[UPLOAD DEBUG] fetch 監視');
          console.log('→ URL', resource);
          console.log('→ Content-Type', init.headers && init.headers['Content-Type']);
          console.log('→ body は FormData?', init.body instanceof FormData);
          console.groupEnd();
        }
        return _fetch(...args);
      };
    </script>
    <!-- ▲ debug-upload.js ここまで -->
  </body>
</html>